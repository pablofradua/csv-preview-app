<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

<h:head>
    <title>CSV Preview</title>

    <h:outputStylesheet library="vendor" name="primeflex/primeflex.min.css"/>
    <h:outputStylesheet library="css" name="styles.css"/>
</h:head>

<h:body>
	<p:importEnum type="com.exasol.csv.view.file.ColumnSeparator" var="ColumnSeparator"
                  allSuffix="ALL_ENUM_VALUES"/>
	<p:importEnum type="com.exasol.csv.view.file.HeaderOrigin" var="HeaderOrigin"
                  allSuffix="ALL_ENUM_VALUES"/>
	<p:importEnum type="com.exasol.csv.view.file.RowSeparator" var="RowSeparator"
                  allSuffix="ALL_ENUM_VALUES"/>
	<p:importEnum type="com.exasol.csv.view.file.StringDelimiter" var="StringDelimiter"
                  allSuffix="ALL_ENUM_VALUES"/>
                  
  	<h:form id="table-form" styleClass="full-height p-grid p-align-stretch vertical-container content" enctype="multipart/form-data">
       	<p:growl id="growl" sticky="true">
       		<p:autoUpdate/>
       	</p:growl>
        <div class="p-col-fixed full-height sidebar">
            <div class="full-height">
                <p:card id="control-card">
                    <f:facet name="title">
                        File
                    </f:facet>
                    <div class="ui-fluid">
                        <div class="p-field">
                            <label for="@next">Step 1: Upload a file</label>
                            <p:fileUpload accept="text/csv" allowTypes="/(\.|\/)(csv)$/" label="Select file" listener="#{fileUploadListener.handleFileUpload}"
                            update="results-section @(.upload-option)"/>
                        </div>
                        <div class="p-field">
                            <label for="@next">Column Separator</label>
                            <p:selectOneMenu id="column-separator" value="#{fileDataPanel.uploadOptions.columnSeparator}" disabled="#{fileDataPanel.noFileLoaded}"
                            	styleClass="upload-option">
                            	<f:selectItems var="item" value="#{ColumnSeparator.ALL_ENUM_VALUES}" itemLabel="#{item.label}" itemValue="#{item}"/>
                            	<p:ajax listener="#{fileDataPanel.handleUploadOptionChange}" update="table"/>
                            </p:selectOneMenu>
                        </div>
                        <div class="p-field">
                            <label for="@next">Row Separator</label>
                            <p:selectOneMenu id="row-separator" value="#{fileDataPanel.uploadOptions.rowSeparator}" disabled="#{fileDataPanel.noFileLoaded}"
                            	styleClass="upload-option">
                            	<f:selectItems var="item" value="#{RowSeparator.ALL_ENUM_VALUES}" itemLabel="#{item.label}" itemValue="#{item}"/>
                            	<p:ajax listener="#{fileDataPanel.handleUploadOptionChange}" update="table"/>
                            </p:selectOneMenu>
                        </div>
                        <div class="p-field">
                            <label for="@next">Column Delimiter</label>
                            <p:selectOneMenu id="column-delimiter" value="#{fileDataPanel.uploadOptions.stringDelimiter}" disabled="#{fileDataPanel.noFileLoaded}"
                            	styleClass="upload-option">
                            	<f:selectItems var="item" value="#{StringDelimiter.ALL_ENUM_VALUES}" itemLabel="#{item.label}" itemValue="#{item}"/>
                            	<p:ajax listener="#{fileDataPanel.handleUploadOptionChange}" update="table"/>
                            </p:selectOneMenu>
                        </div>
                        <div class="p-field">
                            <label for="@next">Encoding</label>
                            <p:selectOneMenu id="encoding" value="#{fileDataPanel.uploadOptions.charset}" converter="com.exasol.csv.view.CharsetConverter" disabled="#{fileDataPanel.noFileLoaded}"
                            	styleClass="upload-option">
                            	<f:selectItems var="item" value="#{fileDataPanel.uploadOptions.availableCharsets()}"/>
                            	<p:ajax listener="#{fileDataPanel.handleUploadOptionChange}" update="table"/>
                            </p:selectOneMenu>
                        </div>
                        <div class="p-field">
                            <p:selectBooleanCheckbox value="#{fileDataPanel.uploadOptions.parseColumnHeadersFromFirstRow}" itemLabel="Parse column headers from first row" 
                            	disabled="#{fileDataPanel.noFileLoaded}" styleClass="upload-option">
                            	<p:ajax listener="#{fileDataPanel.handleUploadOptionChange}" update="table"/>
                           	</p:selectBooleanCheckbox>
                        </div>
                    </div>
                </p:card>
            </div>
        </div>
        <div jsf:id="results-section" class="p-col full-height">
        		<div id="results-header" class="p-grid">
        			<div id="results-filename" class="p-col ui-widget">
		            	<h:outputFormat value="Displaying file: {0}" rendered="#{fileDataPanel.fileLoaded}" styleClass="stick-to-bottom">
		            		<f:param value="#{fileDataPanel.csvFile.filename}"/>
		            	</h:outputFormat>
		            	<h:outputText value="No file selected" rendered="#{fileDataPanel.noFileLoaded}" styleClass="stick-to-bottom"/>
	            	</div>
        			<div id="search-section" class="p-col">
	                	<p:inputText id="fileSearchFilter" onkeyup="filterResults()" placeholder="Search file" disabled="#{fileDataPanel.noFileLoaded}"/>
                	</div>
                </div>
                <p:dataTable id="table"
                             var="fileRow"
                             widgetVar="resultsTable"
                             value="#{fileDataPanel.csvFile.rows}"
                             filteredValue="#{fileDataPanel.filteredRows}"
                             scrollable="true"
                             scrollHeight="100%"
                             styleClass="csv-preview-table"
                             rendered="#{fileDataPanel.fileLoaded}"
                             virtualScroll="true"
                             scrollRows="50"
                             globalFilterFunction="#{csvTableGlobalFilter.filterFile}">
                    <f:facet name="header">
	                    <p:inputText id="globalFilter" onkeyup="PF('resultsTable').filter()"/>
                    </f:facet>
					<p:columns value="#{fileDataPanel.csvFile.columnNames}"  var="columnName" columnIndexVar="colIndex" sortBy="#{fileRow[colIndex]}" filterable="true">  
					  <f:facet name="header">#{columnName}</f:facet>
					  <h:outputText value="#{fileRow[colIndex]}" />
					</p:columns>
                </p:dataTable>
        </div>
        <script type="text/javascript">
	        function filterResults() {
	        	var filterValue = $("input[id$='fileSearchFilter']").val();
	
		        $("input[id$='globalFilter']").val(filterValue);
		        $("input[id$='globalFilter']").trigger('keyup')
	        }
        </script> 
    </h:form>
</h:body>
</html>
